[<- К содержанию](readme.md)

### 3.3 Управление ветками

Если `git branch` запустить без параметров, то можно получить простой список имеющихся веток.

```
$ git branch
  iss53
* master
  testing
  ```

Символ `*` указывает ветку, на которой мы находимся в данный моменьт (т. е. ветку, на которую указывает HEAD). Это означает, что если сейчас сделаеть коммит, ветка `master` переместится вперёд в соответствии с последними изменениями.

`git branch -v` покажет последний коммит каждой из веток.

```
$ git branch -v
  iss53   93b412c Fix javascript issue
* master  7a98805 Merge branch 'iss53'
  testing 782fd34 Add scott to the author list in the readm
```

`git branch --merged` покажет ветки, которые уже слиты с текущей:

```
$ git branch --merged
  iss53
* master
```

Ветка `iss53` присутствует в этом списке потому что она ранее была слита в `master`.

Те ветки из этого списка, перед которыми нет символа *, можно смело удалять.
`git branch -d <имя ветки>` удалит ветку. Наработки из этих веток уже включены в другую ветку,

`git branch --no-merged` покажет все ветки, содержащие наработки, которые пока еще не слиты в текущую ветку.

```
$ git branch --no-merged
  testing
```

Если попытаться удалить неслитую ветку при помощи `git branch -d` приведет к ошибке:

```
$ git branch -d testing
error: The branch 'testing' is not fully merged.
If you are sure you want to delete it, run 'git branch -D testing'.
```

Если нужно действительно удалить ветку вместе со всеми наработками, то существует опция `-D`, как указано в подсказке.

Если в качестве аргумента не указан коммит или ветка, то опции --merged и --no-merged покажут что уже слито или не слито с вашей текущей веткой соответственно.

Вы всегда можете указать дополнительный аргумент для вывода той же информации, но относительно указанной ветки предварительно не извлекая и не переходя на неё.

```
$ git checkout testing
$ git branch --no-merged master
  topicA
  featureB
```
#### Переименование ветки

**_Не переименовывайте ветки, которые всё ещё используются другими участниками. Не переименовывайте ветку в `master/main/mainline`, не прочитав раздел «Изменение имени главной ветки»._**

Например чтобы изменить название ветки с `bad-branch-name` на `corrected-branch-name` сохранив при этом всю историю. А так же изменить название ветки на удаленном репозитории, надо слелать следующее:

`git branch --move bad-branch-name corrected-branch-name` переименует ветку в локальном репозитрии.

`git push --set-upstream origin corrected-branch-name` переименует ветку на сервере.

`git branch --all` покажет где мы находимся.

```
$ git branch --all
* corrected-branch-name
  main
  remotes/origin/bad-branch-name
  remotes/origin/corrected-branch-name
  remotes/origin/main
```

`git push origin --delete bad-branch-name` удалит старое имя ветки.

#### Изменение имени главной ветки

**_Изменение имени ветки, например master/main/mainline/default, сломает интеграции, службы, вспомогательные утилиты и скрипты сборки, которые использует ваш репозиторий. Прежде чем сделать это, обязательно проконсультируйтесь с коллегами. Также убедитесь, что вы выполнили тщательный поиск в своём репозитории и обновили все ссылки на старое имя ветки в вашем коде или скриптах._**

`git branch --move master main` переименует `ветку master` в `main` и локалльная ветка `master` перестанет существовать.

`git push --set-upstream origin main` переименует ветку в удаленном репозитории.

В итоге состояние репозитория будет таким:

```
git branch --all
* main
  remotes/origin/HEAD -> origin/master
  remotes/origin/main
  remotes/origin/master
```
Ваша локальная ветка `master` исчезла, так как она заменена веткой `main`. Ветка main доступна в удалённом репозитории. Старая ветка `master` всё ещё присутствует в удалённом репозитории. Остальные участники будут продолжать использовать ветку master в качестве основы для своей работы, пока вы не совершите ряд дополнительных действий.

Теперь, для завершения перехода на новую ветку перед вами стоят следующие задачи:

* Все проекты, которые зависят от текущего, должны будут обновить свой код и/или конфигурацию.
* Обновите конфигурацию всех запускаемых тестов.
* Исправьте скрипты сборки и публикации артефактов.
* Поправьте настройки репозитория на сервере: задайте новую ветку по умолчанию, обновите правила слияния, а также прочие настройки, которые зависят от имени веток.
* Обновите документацию, исправив ссылки, указывающие на старую ветку.
* Слейте или отмените запросы на слияние изменений, нацеленные на старую ветку.

После того, как вы выполнили все эти задачи и уверены, что ветка main работает так же, как ветка `master`, вы можете удалить ветку `master`:

`git push origin --delete master` 

[<- Назад](basick-branching-merging.md)

[Вперед ->](branching-workflows.md)